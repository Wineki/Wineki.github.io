<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Wineki Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Wineki Blog">
<meta property="og:url" content="http://imwineki.cn/index.html">
<meta property="og:site_name" content="Wineki Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wineki Blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Wineki Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="http://p3.qhimg.com/d/inn/5bb54637/logo.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://p7.qhimg.com/d/inn/c0099c2d/Wineki.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Wineki</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="http://www.github.com/Wineki" title="github">github</a>
					        
								<a class="rss" target="_blank" href="/#" title="rss">rss</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/HTTP-web传输/" style="font-size: 10px;">HTTP web传输</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">联系我：wuning_aiali@163.com</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Wineki</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="http://p7.qhimg.com/d/inn/c0099c2d/Wineki.jpg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Wineki</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="http://www.github.com/Wineki" title="github">github</a>
			        
						<a class="rss" target="_blank" href="/#" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap">
  
    <article id="post-HTTP解读（二）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/05/HTTP解读（二）/" class="article-date">
  	<time datetime="2016-02-05T03:07:42.000Z" itemprop="datePublished">2016-02-05</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/05/HTTP解读（二）/">HTTP解读（二）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-HTTP解读（一）" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/01/25/HTTP解读（一）/" class="article-date">
  	<time datetime="2016-01-25T15:00:38.000Z" itemprop="datePublished">2016-01-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/25/HTTP解读（一）/">HTTP解读（一）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近一直在学习HTTP相关知识，学到的知识总是要总结一下嘛，分几篇文章总结粗来~<br>这篇主要内容关于Web基础相关的，知识点都比较浅显易懂，恩，闲话就说到这里。<br>HTTP是因特网的传输媒介，是应用层协议，它把联网细节都交给了通用可靠的因特网传输协议：TCP/IP。大概的关系如图:<img src="/img/http2.png" alt="">当客户端与服务器沟通的时候就需要HTTP作为信使来传递消息，通常情况下，客户端会给服务器发送一条HTTP请求，请求需要的文档，服务器收到请求后经过处理就会给客户端做出一个响应，告诉客户端处理结果。当然这里我们说的客户端其实就是我们熟悉的浏览器。举个栗子🌰，当你在浏览器里输入<a href="http://imwineki.cn/index.html">http://imwineki.cn/index.html</a>,然后按下回车键后，简单来说，就会发生以下这一些列的事情，如图，<br><img src="/img/http1.png" alt="">浏览器就会向服务器www.imwineki.cn发送一条HTTP请求，此时服务器收到请求后，就会去寻找index.html的文档，找到了的话就会返回给浏览器文档信息。以及一个200的状态码，如果失败的话就会根据具体的错误情况返回具体的错误状态。<br>稍微复杂一点来说，当你按下回车后，http会解析URL的语法，通常包含：以下几种：<br><img src="/img/http3.png" alt="">，获取到<http:imwineki.cn index.html="">使用的是http协议，同过DNS查询主机，获取到该域名下对应的服务器的IP地址，以及端口号（默认情况下是80端口），获取到服务器的IP地址后，此时如果我土豪的买了CDN服务的话，接下来代理就会将请求发送给缓存（CDN），缓存根据文件副本的新鲜度来决定返回客户端数据还是向原始服务器发出请求,如果代理需要向服务器发请求，则CDN充当客户端的角色会向服务器发送请求（具体请求头部等这里先不介绍），当请求到达服务器后，则首先到达反向代理服务器，如果反向代理中包含文件副本则直接返回，否则反向代理再次向服务器或服务器集群转发请求，如图<img src="/img/http4.png" alt="">。当然我说的这些流程都是小型网站，至于大型网站架构，中间还要包含LVS负载均衡，虚拟IP等加速工具。这里需要说明的一点：反向代理和CDN都属于缓存，都是为了减少服务器压力，降低用户等待时间，加速网站相应的，所不同的是：CDN部署在网络提供商的机房，在用户发出请求后，可以优先从距离最近的网络提供商机房获取数据，但反向代理则是部署在中心机房，当请求到来时，会优先走反向代理。</http:imwineki.cn></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTTP-web传输/">HTTP web传输</a></li></ul>
	</div>

      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Thinkjs实现异步加载模板方法" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/14/Thinkjs实现异步加载模板方法/" class="article-date">
  	<time datetime="2015-12-14T09:23:10.000Z" itemprop="datePublished">2015-12-14</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/14/Thinkjs实现异步加载模板方法/">Thinkjs实现异步加载</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天来总结一下关于使用Thinkjs来实现页面异步加载的原理和做法。<br>我从前端讲起，首先流程中包含一下几部分：</p>
<table>
<thead>
<tr>
<th>View</th>
<th style="text-align:center">Controller</th>
<th style="text-align:right">Model</th>
</tr>
</thead>
<tbody>
<tr>
<td>筛选框（filter）用于筛选内容，位置在母模版</td>
<td style="text-align:center">母模版对应的Action</td>
<td style="text-align:right">调用数据库</td>
</tr>
<tr>
<td>异步加载内容（content），位置在子模板</td>
<td style="text-align:center">ajax判断后的处理</td>
<td style="text-align:right">调用数据库</td>
</tr>
</tbody>
</table>
<p>下面根据代码具体解释一下：<br>母模版的view层demo：</p>
<pre><code><span class="xml">/*这里是一个filter*/
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"filter"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">dl</span> <span class="attribute">class</span>=<span class="value">"row"</span>&gt;</span>
        <span class="tag">&lt;<span class="title">dt</span>&gt;</span>大小<span class="tag">&lt;/<span class="title">dt</span>&gt;</span>
        <span class="tag">&lt;<span class="title">dd</span>&gt;</span>
            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#"</span>&gt;</span>全部<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#"</span>&gt;</span>大<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#"</span>&gt;</span>中<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
            <span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"#"</span>&gt;</span>小<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
        <span class="tag">&lt;/<span class="title">dd</span>&gt;</span>
    <span class="tag">&lt;/<span class="title">dl</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span>
/*这里是一个content*/
<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"content"</span>&gt;</span>
    </span>&lt;%<span class="ruby"><span class="keyword">include</span> ajax/tplselectajax.html</span>%&gt;<span class="xml">     /*这里include进来一个子模板，将来异步刷新时就只刷新子模板数据*/
<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span>
</code></pre><p>子模板的view层demo:<br>    可以看到从后端传来一个tpllist的数据字段，相当于是一个数组，我们把它循环输出出来，同时一会异步刷新的时候我们也只是刷新这个子模板的数据，而不会改变上面的母模板的数据。</p>
<pre><code><span class="xml"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"cont-wrap"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">ul</span>&gt;</span>
        </span><span class="vbscript">&lt;%tpllist.forEach(<span class="keyword">function</span>(item){ %&gt;</span><span class="xml">
            <span class="tag">&lt;<span class="title">li</span>&gt;</span>
                <span class="tag">&lt;<span class="title">p</span>&gt;</span></span><span class="vbscript">&lt;%=item.desc%&gt;</span><span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span>
                <span class="tag">&lt;<span class="title">p</span>&gt;</span></span><span class="vbscript">&lt;%=item.name%&gt;</span><span class="xml"><span class="tag">&lt;/<span class="title">p</span>&gt;</span>
            <span class="tag">&lt;/<span class="title">li</span>&gt;</span>
        </span><span class="vbscript">&lt;%})%&gt;</span><span class="xml">
    <span class="tag">&lt;/<span class="title">ul</span>&gt;</span>
<span class="tag">&lt;/<span class="title">div</span>&gt;</span></span>
</code></pre><p>当然这里需要js来帮忙使用ajax来进行一步调用:</p>
<pre><code>$(<span class="string">'a'</span>).on(<span class="string">'click'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>{
    e.preventDefault();
    $.ajax({
        url:<span class="string">''</span>,<span class="comment">/*填写请求路径*/</span>
        dataTpe:<span class="string">'jsonp'</span>,
        data:<span class="string">''</span>,<span class="comment">/*传送的数据*/</span>
        success:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{

        },
        fail:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>{

        }

    });
});
</code></pre><p>Controller层的处理:</p>
<pre><code>tplselectAction: <span class="function"><span class="keyword">function</span><span class="params">()</span></span>{
    <span class="keyword">var</span> <span class="keyword">self</span> = this;
    <span class="comment">/*获取get请求的参数，在这个demo中其实就是筛选条件*/</span>
    <span class="keyword">var</span> data = this.get();  
    <span class="keyword">var</span> pg = data.pg;
    <span class="comment">/*判断时候是ajax请求，如果是则结果返回true*/</span>
    <span class="keyword">var</span> isAjax = <span class="keyword">self</span>.isAjax();   
    <span class="comment">/*子模板渲染路径，注意此处根目录是Home*/</span>
    <span class="keyword">var</span> tpl = <span class="string">'Home/ajax/build_tplselectajax.html'</span>;         
    <span class="keyword">if</span>(!isAjax){
        <span class="comment">/*如果不是ajax请求，也就是浏览器首次渲染数据时，默认选择展示全部数据*/</span>
        data = { cateId: <span class="string">'全部'</span>}
    }
    <span class="comment">/*调用数据库获取数据，调用ajaxdata方法*/</span>
    D(<span class="string">'Template'</span>).ajaxdata(data,pg).then(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
        <span class="keyword">var</span> <span class="keyword">list</span> = shiftObject(data,<span class="string">'data'</span>);  <span class="comment">/*将数据库data字段整体存入list*/</span>
        <span class="keyword">self</span>.assign(<span class="string">'tpllist'</span>,<span class="keyword">list</span>);  
        <span class="keyword">self</span>.assign(<span class="string">'isAjax'</span>,isAjax);
        <span class="keyword">if</span>(isAjax){
            <span class="comment">/*如果是ajax模板，则利用fetch这个方法对模板进行重新渲染，并返回相应json格式的状态值*/</span>
            <span class="keyword">if</span>(<span class="keyword">list</span>.length !== <span class="number">0</span>){
                <span class="keyword">self</span>.fetch(tpl).then(<span class="function"><span class="keyword">function</span><span class="params">(content)</span></span>{
                   <span class="keyword">self</span>.jsonp({status:<span class="string">"success"</span>,cont:content});
                });
            }<span class="keyword">else</span>{
                <span class="keyword">self</span>.jsonp({status:<span class="string">"fail"</span>,cont:<span class="string">'暂时木有相应的模板，搜搜别的试试吧！'</span>});
            }
        }<span class="keyword">else</span>{
            <span class="comment">/*首次加载页面则直接展示*/</span>
            <span class="keyword">self</span>.display();
        }
    });
}
</code></pre><p>Model层的处理demo：</p>
<pre><code>ajaxdata: function(<span class="built_in">data</span>){
    <span class="built_in">var</span> <span class="built_in">self</span> = this;
    <span class="keyword">if</span>(<span class="built_in">data</span><span class="built_in">.</span>cateId = <span class="string">'全部'</span>){
        <span class="keyword">return</span> <span class="built_in">self</span><span class="built_in">.</span><span class="keyword">order</span>({<span class="string">'id'</span>:<span class="string">'desc'</span>})<span class="built_in">.</span><span class="keyword">select</span>()<span class="built_in">.</span>then(function(<span class="built_in">data</span>){
            <span class="keyword">return</span> <span class="built_in">data</span>;
        });
    }<span class="keyword">else</span>{
        <span class="keyword">return</span> <span class="built_in">self</span><span class="built_in">.</span><span class="keyword">where</span>({<span class="string">'title'</span>:<span class="built_in">data</span><span class="built_in">.</span>cateId})<span class="built_in">.</span><span class="keyword">order</span>({<span class="string">'id'</span>:<span class="string">'desc'</span>})<span class="built_in">.</span><span class="keyword">select</span>()<span class="built_in">.</span>then(function(<span class="built_in">data</span>){
            <span class="keyword">return</span> <span class="built_in">data</span>;    
        });
    }
}
</code></pre><p>Model层的处理：<br>这里是项目源代码的查询:</p>
<pre><code>ajaxdata: <span class="function"><span class="keyword">function</span><span class="params">(data,pg)</span></span>{
        var self = this;
        var <span class="keyword">where</span> = <span class="keyword">where</span> || {};
        /*此处包含其他参数的复合查询，展示出来，在demo中暂时不考虑*/
        /*var join = {
            templatecate: {
                join: <span class="string">'left'</span>,
                as: <span class="string">'c'</span>,
                on: [<span class="string">'cateId'</span>,<span class="string">'id'</span>]
            }
        };
        var pg = pg || (isNumber(<span class="keyword">where</span>) ? <span class="keyword">where</span> : null);
        var lastCond = {};
        <span class="keyword">if</span>(<span class="comment">!isEmpty(where)){</span>
            for(var i <span class="type">in</span> <span class="keyword">where</span>){
                var find = false;
                for(var s <span class="type">in</span> fields){
                    <span class="keyword">if</span>(fields[s].indexOf(i) &gt; -<span class="number">1</span>){
                        lastCond[s + <span class="string">'.'</span> + i] = <span class="keyword">where</span>[i];
                        find = true;
                        break;
                    }
                }
                <span class="keyword">if</span>(find)<span class="keyword">continue</span>;
                lastCond[<span class="string">'t.'</span> + i] = <span class="keyword">where</span>[i];
            }
        }*/
        <span class="keyword">if</span>(<span class="type">data</span>.cateId == <span class="string">'全部'</span>){
            var per = C(<span class="string">'db_nums_per_page'</span>);
            /*在筛选框为‘全部’时，将数据中全部数据按条件查询出来，并且进行分页查询（分页查询此处我们暂时不讨论）*/
            <span class="keyword">return</span> self.<span class="keyword">where</span>({<span class="string">'endType'</span>:<span class="type">data</span>.<span class="keyword">endType</span>,<span class="string">'isForbidden'</span>:<span class="number">0</span>}).order({<span class="string">'id'</span>: <span class="string">'desc'</span>}).page(pg).<span class="keyword">select</span>().<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
                    <span class="keyword">return</span> <span class="type">data</span>;
            }).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(datalist)</span></span>{
                /*将返回结果进行处理，并返回相应的参数*/
                <span class="keyword">return</span> self.field(<span class="string">'count(id) as count'</span>).<span class="keyword">where</span>({<span class="string">'endType'</span>:<span class="type">data</span>.<span class="keyword">endType</span>}).find().<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>{
                    <span class="keyword">return</span> {
                        <span class="type">data</span>: datalist,
                        <span class="built_in">count</span>: res.<span class="built_in">count</span>,
                        page: pg || <span class="number">1</span>,
                        num: per,
                        total: Math.ceil(res.<span class="built_in">count</span> / per)
                    };
                });
            }); 
        }<span class="keyword">else</span>{
            /ajax请求是查询结果，按照cateId的值进行查询/
            var per = C(<span class="string">'db_nums_per_page'</span>);
            <span class="keyword">return</span> self.alias(<span class="string">'t'</span>).field(<span class="string">'t.*'</span>).join(join).<span class="keyword">where</span>({<span class="string">'c.title'</span>:<span class="type">data</span>.cateId,<span class="string">'t.endType'</span>:<span class="type">data</span>.<span class="keyword">endType</span>,<span class="string">'isForbidden'</span>:<span class="number">0</span>}).order({<span class="string">'t.id'</span>: <span class="string">'desc'</span>}).page(pg).<span class="keyword">select</span>().<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
                    <span class="keyword">return</span> <span class="type">data</span>;
            }).<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(datalist)</span></span>{
                <span class="keyword">return</span> self.alias(<span class="string">'t'</span>).field(<span class="string">'count(t.id) as count'</span>).join(join).<span class="keyword">where</span>({<span class="string">'c.title'</span>:<span class="type">data</span>.cateId,<span class="string">'t.endType'</span>:<span class="type">data</span>.<span class="keyword">endType</span>}).find().<span class="keyword">then</span>(<span class="function"><span class="keyword">function</span><span class="params">(res)</span></span>{
                    <span class="keyword">return</span> {
                        <span class="type">data</span>: datalist,
                        <span class="built_in">count</span>: res.<span class="built_in">count</span>,
                        page: pg || <span class="number">1</span>,
                        num: per,
                        total: Math.ceil(res.<span class="built_in">count</span> / per)
                    };
                });
            }); 
        }

    }
</code></pre><p>关于Thinkjs里面的具体语法我就不一一解释了，这里主要来讲一下大概的思路，首先前端需要在模板中将需要异步加载的模板进行include,方便后续的异步刷洗页面，同时你需要用js来进行一个ajax的通信，接着就是Controller层对模板的渲染，在拿到前端传来的请求数据后，调用model层的方法从数据库中取出数据，此时需要使用feteh这个方法重新渲染页面。（其实也可以使用display(渲染模板路径)这个方法，只是渲染的方式不用而已，结果是一样的）感兴趣的同学可以搜一下API。<br>sql语句写的不好，还望大家见谅~~哈哈哈，先就这么多~</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-css选择器优先级权重分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/25/css选择器优先级权重分析/" class="article-date">
  	<time datetime="2015-11-25T15:25:41.000Z" itemprop="datePublished">2015-11-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/25/css选择器优先级权重分析/">css选择器优先级权重分析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近写项目发现了css的一些小问题总结出来，主要是关于css选择器权重相关的。<br>在浏览器中，我们在编写页面样式的时候通常都要考虑选择器的优先级，使得页面的样式不会被覆盖或覆盖其他样式。<br>总体来说优先级是这样的（此处从高到底排序）：</p>
<blockquote>
<p>!important  -&gt;   行内样式style(此处包含写在html结构中的和用js动态加载上去的style)  -&gt;  id选择器  -&gt;  伪类  -&gt;  class选择器  -&gt;  元素选择器  -&gt;  通用选择器( * )</p>
</blockquote>
<p>这里我来对一些细节说明一下：<br>1.页面中能不要使用！important尽量避免使用，因为从严格意义上讲，！important与优先级是没有关系的，当使用!important定义模块的时候页面中再对其进行任何操作都无济于事了，改变了样式表本来的级联规则，难以调试。<br>2.行内样式这里的两方面距离说明：</p>
<pre><code><span class="number">1</span>.&lt;<span class="tag">p</span> style=<span class="string">"color:red"</span> id=<span class="string">"test"</span>&gt;&lt;/p&gt;

<span class="number">2</span>. document.<span class="function"><span class="title">getElementById</span><span class="params">(<span class="string">'topnav'</span>)</span></span><span class="class">.style</span><span class="class">.color</span> = <span class="string">'red'</span>
</code></pre><p>3.关于伪类的优先级遵循：LVHA,从右向左优先级逐级增加.然而not作为伪类，却并不列入伪类优先级的评比中，也就是说当元素有重新定义的样式的时候not会被自动覆盖。举例说明：</p>
<pre><code>&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"test-not"</span>&gt;测试伪类<span class="keyword">not</span>&lt;/<span class="keyword">div</span>&gt;
&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"not"</span>&gt;<span class="number">123</span>&lt;/<span class="keyword">div</span>&gt;
</code></pre><p>当定义样式为：</p>
<pre><code><span class="rule"><span class="attribute">.test-not</span>:<span class="value"><span class="function">not</span>(.not){
    color:red</span></span>;
}
</code></pre><p>效果如下图：<br><img src="/img/1.png" alt=""><br>123为黑色，说明样式中not生效了。<br>当定义样式为：</p>
<pre><code><span class="class">.not</span><span class="rules">{
    <span class="rule"><span class="attribute">color</span>:<span class="value">red</span></span>;
}</span>
<span class="rule"><span class="attribute">.test-not</span>:<span class="value"><span class="function">not</span>(.not){
    color:red</span></span>;
}
</code></pre><p>效果如下图：<br><img src="/img/2.png" alt=""><br>123显示为红色，说明not样式被元素本身定义的样式覆盖了。<br>4.关于a标签的说明：</p>
<pre><code>a:link{
    <span class="built_in">color</span>:<span class="built_in">green</span>;
}
<span class="comment">/*a:visited{
    color:yellow;
}*/</span>
.test{
    <span class="built_in">color</span>:<span class="built_in">red</span>;
}
&lt;a href=<span class="string">"/"</span> class=<span class="string">"test-relative"</span>&gt;相对目录&lt;/a&gt;
</code></pre><p>当我们把a标签加上link伪类的时候，link的优先级就高于class=”test”,所以在首次载入页面的时候文字会显示绿色，当我们点击链接后，发现文字又变回了红色，这是因为链接点击后的状态为visited，而在样式中我们将visited的样式定义注释掉了，所以链接样式就会直接显示class=”test”的样式了。<br>当我们将visited的样式定义去掉后，会发现颜色显示为黄色。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
    <article id="post-Thinkjs链式结构总结" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/11/25/Thinkjs链式结构总结/" class="article-date">
  	<time datetime="2015-11-25T15:12:59.000Z" itemprop="datePublished">2015-11-25</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/11/25/Thinkjs链式结构总结/">Thinkjs链式结构总结</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>第一篇博文，由于刚开始学习markdown的方式写博文，速度好慢。<br><br>最近在用<em>Thinkjs</em>写项目，又向从前端到全段的梦想迈进了一步，哈哈，写话少说，share一些干货粗来。<br><br><em>Thinkjs</em>是基于nodejs的web框架，具体的文档可以参看<a href="https://thinkjs.org/" target="_blank" rel="external">https://thinkjs.org/</a>官方文档，我使用的是1.0版本，所以暂时只讨论1.0的一些情况。<br>今天写项目中遇到这样一个问题：<br>我从session中获取到用户的信息，然后获取存在session中的userName，使用：</p>
<pre><code><span class="keyword">this</span>.session(<span class="string">"userInfo"</span>).then(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
...
});
</code></pre><p>的方式，另一方面我通过数据库查询获取到用户在数据库中存储的userName,然后比较这两个userName时候否相同，使用</p>
<pre><code><span class="tag">D</span>(<span class="string">'User'</span>)<span class="class">.get</span>(id)<span class="class">.then</span>(<span class="function">function</span>(data){
...
}); 
</code></pre><p>再将一个标签值assign到view层对应的页面。<br>然而就在编写的过程中我发现我在比较之后，无法将标签值传入页面。<br>具体代码如图：<br><img src="http://p6.qhimg.com/d/inn/f451a883/code.png" alt="1"><br>这是一份伪代码，上面的图片的大概意思就是这样的：</p>
<pre><code><span class="keyword">return</span> D(<span class="string">'User'</span>).get(id).then(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
    <span class="keyword">return</span> <span class="keyword">self</span>.session(<span class="string">'user'</span>).then(<span class="function"><span class="keyword">function</span><span class="params">(user)</span></span>{
        <span class="comment">//验证session信息,返回editable</span>
        <span class="keyword">self</span>.assign(<span class="string">'editable'</span>,editable);
        <span class="keyword">self</span>.assign(<span class="string">'user'</span>,data);
        <span class="keyword">self</span>.display();
    });
});
</code></pre><p>最初我是这么写的：</p>
<pre><code><span class="keyword">return</span> D(<span class="string">'User'</span>).get(id).then(<span class="function"><span class="keyword">function</span><span class="params">(data)</span></span>{
    <span class="keyword">var</span> session = <span class="keyword">self</span>.session(<span class="string">'user'</span>).then(<span class="function"><span class="keyword">function</span><span class="params">(user)</span></span>{
        <span class="comment">//验证session信息,返回editable</span>
        <span class="keyword">self</span>.assign(<span class="string">'editable'</span>,editable);
    });
    <span class="keyword">self</span>.assign(<span class="string">'user'</span>,data);
    <span class="keyword">self</span>.display();
});
</code></pre><p>然后我发现这个根本没有想下执行，页面直接白屏了，原因其实是这样的，在<em>thinkjs</em>中绝大多数方法都是异步调用的，并且包装成promise，而promise是通过<br><em>try{}catch{}</em>进行异常捕获的，很显然我没有catch异常所以导致直接白屏，同时由于thinkjs中许多的调用都是异步调用（这个之前说过），也就是说在session还没有返回值的时候程序就向下执行了，但是此处我必须要它同步来执行，也就是说按照程序写的先后顺序来执行，所以就采用return的方法，将没有个异步方法串联起来，形成一个调用链就搞定了。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>







  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Wineki
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>